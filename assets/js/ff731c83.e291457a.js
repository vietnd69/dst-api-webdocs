"use strict";(self.webpackChunkdst_api_webdocs=self.webpackChunkdst_api_webdocs||[]).push([[95778],{457:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"game-scripts/core-systems/data-management/saves/savefileupgrades","title":"Save File Upgrades","description":"Save data migration and upgrade system for maintaining compatibility across game versions","source":"@site/docs/game-scripts/core-systems/data-management/saves/savefileupgrades.md","sourceDirName":"game-scripts/core-systems/data-management/saves","slug":"/game-scripts/core-systems/data-management/saves/savefileupgrades","permalink":"/dst-api-webdocs/docs/game-scripts/core-systems/data-management/saves/savefileupgrades","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"savefileupgrades","title":"Save File Upgrades","description":"Save data migration and upgrade system for maintaining compatibility across game versions","sidebar_position":2,"last_updated":"2025-06-21T00:00:00.000Z","build_version":676042,"change_status":"stable"},"sidebar":"docs","previous":{"title":"Saves Overview","permalink":"/dst-api-webdocs/docs/game-scripts/core-systems/data-management/saves/"},"next":{"title":"SaveIndex","permalink":"/dst-api-webdocs/docs/game-scripts/core-systems/data-management/saves/saveindex"}}');var i=n(74848),t=n(28453);const a={id:"savefileupgrades",title:"Save File Upgrades",description:"Save data migration and upgrade system for maintaining compatibility across game versions",sidebar_position:2,last_updated:new Date("2025-06-21T00:00:00.000Z"),build_version:676042,change_status:"stable"},d="Save File Upgrades",l={},o=[{value:"Version History",id:"version-history",level:2},{value:"Overview",id:"overview",level:2},{value:"Constants",id:"constants",level:2},{value:"VERSION",id:"version",level:3},{value:"Core Concepts",id:"core-concepts",level:2},{value:"Version-Based Upgrades",id:"version-based-upgrades",level:3},{value:"Selective Application",id:"selective-application",level:3},{value:"Preservation of Game State",id:"preservation-of-game-state",level:3},{value:"Retrofitting System",id:"retrofitting-system",level:3},{value:"Utility Functions",id:"utility-functions",level:2},{value:"utilities.UpgradeUserPresetFromV1toV2(preset, custompresets)",id:"upgrade-user-preset-v1-v2",level:3},{value:"utilities.UpgradeUserPresetFromV2toV3(preset, custompresets)",id:"upgrade-user-preset-v2-v3",level:3},{value:"utilities.UpgradeUserPresetFromV3toV4(preset, custompresets)",id:"upgrade-user-preset-v3-v4",level:3},{value:"utilities.UpgradeSavedLevelFromV1toV2(level, master_world)",id:"upgrade-saved-level-v1-v2",level:3},{value:"utilities.UpgradeSavedLevelFromV2toV3(level, master_world)",id:"upgrade-saved-level-v2-v3",level:3},{value:"utilities.UpgradeSavedLevelFromV3toV4(level, master_world)",id:"upgrade-saved-level-v3-v4",level:3},{value:"utilities.UpgradeShardIndexFromV1toV2(shardindex)",id:"upgrade-shard-index-v1-v2",level:3},{value:"utilities.UpgradeShardIndexFromV2toV3(shardindex)",id:"upgrade-shard-index-v2-v3",level:3},{value:"utilities.UpgradeShardIndexFromV4toV5(shardindex)",id:"upgrade-shard-index-v4-v5",level:3},{value:"utilities.UpgradeWorldgenoverrideFromV1toV2(wgo)",id:"upgrade-worldgen-override-v1-v2",level:3},{value:"utilities.ApplyPlaystyleOverridesForGameMode(world_options, game_mode)",id:"apply-playstyle-overrides",level:3},{value:"utilities.ConvertSaveIndexToShardSaveIndex(savegameindex, shardsavegameindex)",id:"convert-save-index",level:3},{value:"Version-Specific Upgrades",id:"version-specific-upgrades",level:2},{value:"Version 1 - RoG Season Conversion",id:"version-1---rog-season-conversion",level:3},{value:"Version 2 - Prefab Swap Management",id:"version-2---prefab-swap-management",level:3},{value:"Version 3 - Default Prefab Swaps",id:"version-3---default-prefab-swaps",level:3},{value:"Version 4 Series - A New Reign Updates",id:"version-4-series---a-new-reign-updates",level:3},{value:"Version 5 Series - Return of Them Updates",id:"version-5-series---return-of-them-updates",level:3},{value:"Usage Patterns",id:"usage-patterns",level:2},{value:"Manual Upgrade Application",id:"manual-upgrade-application",level:3},{value:"Automatic Upgrade During Load",id:"automatic-upgrade-during-load",level:3},{value:"Custom Preset Migration",id:"custom-preset-migration",level:3},{value:"Retrofitting System",id:"retrofitting-system-1",level:2},{value:"Forest Map Retrofitting",id:"forest-map-retrofitting",level:3},{value:"Cave Map Retrofitting",id:"cave-map-retrofitting",level:3},{value:"Integration with Game Systems",id:"integration-with-game-systems",level:2},{value:"Save Loading Integration",id:"save-loading-integration",level:3},{value:"World Generation Integration",id:"world-generation-integration",level:3},{value:"Mod System Integration",id:"mod-system-integration",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Sequential Processing",id:"sequential-processing",level:3},{value:"Memory Efficiency",id:"memory-efficiency",level:3},{value:"I/O Optimization",id:"io-optimization",level:3},{value:"Error Handling and Recovery",id:"error-handling-and-recovery",level:2},{value:"Version Validation",id:"version-validation",level:3},{value:"Corruption Recovery",id:"corruption-recovery",level:3},{value:"Console-Specific Handling",id:"console-specific-handling",level:3},{value:"Related Systems",id:"related-systems",level:2},{value:"Development Guidelines",id:"development-guidelines",level:2},{value:"Adding New Upgrades",id:"adding-new-upgrades",level:3},{value:"Version Numbering Convention",id:"version-numbering-convention",level:3},{value:"Retrofit Flag Naming",id:"retrofit-flag-naming",level:3},{value:"Technical Implementation Notes",id:"technical-implementation-notes",level:2},{value:"Upgrade Function Structure",id:"upgrade-function-structure",level:3},{value:"Helper Functions",id:"helper-functions",level:3},{value:"Data Structure Preservation",id:"data-structure-preservation",level:3}];function c(e){const s={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"save-file-upgrades",children:"Save File Upgrades"})}),"\n",(0,i.jsx)(s.h2,{id:"version-history",children:"Version History"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Build Version"}),(0,i.jsx)(s.th,{children:"Change Date"}),(0,i.jsx)(s.th,{children:"Change Type"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsx)(s.tbody,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"676042"}),(0,i.jsx)(s.td,{children:"2025-06-21"}),(0,i.jsx)(s.td,{children:"stable"}),(0,i.jsx)(s.td,{children:"Current version"})]})})]}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"savefileupgrades"})," module provides a comprehensive system for migrating save data between different versions of Don't Starve Together. It ensures backward compatibility by automatically upgrading older save files to current formats while preserving game state and player progress."]}),"\n",(0,i.jsx)(s.h2,{id:"constants",children:"Constants"}),"\n",(0,i.jsx)(s.h3,{id:"version",children:"VERSION"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Value:"})," ",(0,i.jsx)(s.code,{children:"5.156"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"})," The highest version number of all defined upgrades, representing the current save data format version."]}),"\n",(0,i.jsx)(s.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,i.jsx)(s.h3,{id:"version-based-upgrades",children:"Version-Based Upgrades"}),"\n",(0,i.jsx)(s.p,{children:"The system applies sequential upgrades based on version numbers, ensuring all necessary migrations are performed in the correct order."}),"\n",(0,i.jsx)(s.h3,{id:"selective-application",children:"Selective Application"}),"\n",(0,i.jsx)(s.p,{children:"Upgrades are only applied when the save data version is lower than the upgrade version, preventing redundant operations."}),"\n",(0,i.jsx)(s.h3,{id:"preservation-of-game-state",children:"Preservation of Game State"}),"\n",(0,i.jsx)(s.p,{children:"All upgrades are designed to maintain existing game progress while adding new features or fixing compatibility issues."}),"\n",(0,i.jsx)(s.h3,{id:"retrofitting-system",children:"Retrofitting System"}),"\n",(0,i.jsx)(s.p,{children:'Many upgrades use a "retrofitting" approach that adds new content to existing worlds without regenerating them completely.'}),"\n",(0,i.jsx)(s.h2,{id:"utility-functions",children:"Utility Functions"}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-user-preset-v1-v2",children:"utilities.UpgradeUserPresetFromV1toV2(preset, custompresets)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades custom user presets from version 1 to version 2 format, handling base preset resolution and override application."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"preset"})," (table): The preset data to upgrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"custompresets"})," (table): Array of all custom presets for dependency resolution"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Upgraded preset data in version 2 format"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'local upgradedPreset = savefileupgrades.utilities.UpgradeUserPresetFromV1toV2(oldPreset, allPresets)\nprint("Upgraded preset:", upgradedPreset.name)\n'})}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-user-preset-v2-v3",children:"utilities.UpgradeUserPresetFromV2toV3(preset, custompresets)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades user presets from version 2 to 3, adding A New Reign Part 1 content (sculptures)."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"preset"})," (table): The preset data to upgrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"custompresets"})," (table): Array of custom presets"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Upgraded preset with ANR content"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"local v3Preset = savefileupgrades.utilities.UpgradeUserPresetFromV2toV3(v2Preset, presets)\n-- Preset now includes sculpture setpieces for forest worlds\n"})}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-user-preset-v3-v4",children:"utilities.UpgradeUserPresetFromV3toV4(preset, custompresets)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades user presets from version 3 to 4, adding Return of Them: Turn of Tides ocean content."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"preset"})," (table): The preset data to upgrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"custompresets"})," (table): Array of custom presets"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Upgraded preset with ocean features"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"local v4Preset = savefileupgrades.utilities.UpgradeUserPresetFromV3toV4(v3Preset, presets)\n-- Forest presets now have ocean enabled by default\n"})}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-saved-level-v1-v2",children:"utilities.UpgradeSavedLevelFromV1toV2(level, master_world)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades saved level data from the legacy format to version 2, converting preset-based data to the modern override system."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"level"})," (table): The level data to upgrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"master_world"})," (boolean): Whether this is the master world in a cluster"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Upgraded level data with modern format"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'local upgradedLevel = savefileupgrades.utilities.UpgradeSavedLevelFromV1toV2(oldLevel, true)\nprint("Level upgraded:", upgradedLevel.name)\n'})}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-saved-level-v2-v3",children:"utilities.UpgradeSavedLevelFromV2toV3(level, master_world)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades saved level data from version 2 to 3, adding A New Reign sculpture content."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"level"})," (table): The level data to upgrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"master_world"})," (boolean): Whether this is the master world"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Level data with ANR sculpture setpieces"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-saved-level-v3-v4",children:"utilities.UpgradeSavedLevelFromV3toV4(level, master_world)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades saved level data from version 3 to 4, enabling ocean content for forest worlds."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"level"})," (table): The level data to upgrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"master_world"})," (boolean): Whether this is the master world"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Level data with ocean features enabled"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-shard-index-v1-v2",children:"utilities.UpgradeShardIndexFromV1toV2(shardindex)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades shard index data from version 1 to 2, extracting overrides from world save data for Return of Them: Forgotten Knowledge compatibility."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"shardindex"})," (table): The shard index to upgrade"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"savefileupgrades.utilities.UpgradeShardIndexFromV1toV2(myShardIndex)\n-- Shard index now has proper override data extracted\n"})}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-shard-index-v2-v3",children:"utilities.UpgradeShardIndexFromV2toV3(shardindex)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades shard index from version 2 to 3, handling custom preset ID migration for better organization."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"shardindex"})," (table): The shard index to upgrade"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-shard-index-v4-v5",children:"utilities.UpgradeShardIndexFromV4toV5(shardindex)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades shard index from version 4 to 5, migrating game mode settings to the new playstyle system."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"shardindex"})," (table): The shard index to upgrade"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Migration Details:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:'Converts "wilderness" game mode to "survival" with "wilderness" playstyle'}),"\n",(0,i.jsx)(s.li,{children:'Converts "endless" game mode to "survival" with "endless" playstyle'}),"\n",(0,i.jsx)(s.li,{children:'Calculates playstyle for existing "survival" mode based on world settings'}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-worldgen-override-v1-v2",children:"utilities.UpgradeWorldgenoverrideFromV1toV2(wgo)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nUpgrades worldgenoverride.lua files from version 1 to 2 format, consolidating scattered override data into a standardized structure."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"wgo"})," (table): The worldgen override data to upgrade"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"(table): Upgraded override data in standardized format"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"local upgradedOverride = savefileupgrades.utilities.UpgradeWorldgenoverrideFromV1toV2(oldOverride)\n-- Override data now uses consistent structure\n"})}),"\n",(0,i.jsx)(s.h3,{id:"apply-playstyle-overrides",children:"utilities.ApplyPlaystyleOverridesForGameMode(world_options, game_mode)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nApplies world setting overrides appropriate for specific game modes (wilderness, endless)."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"world_options"})," (table): World options to modify"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"game_mode"}),' (string): The game mode ("wilderness" or "endless")']}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'savefileupgrades.utilities.ApplyPlaystyleOverridesForGameMode(worldOpts, "wilderness")\n-- World options now include wilderness-specific settings\n'})}),"\n",(0,i.jsx)(s.h3,{id:"convert-save-index",children:"utilities.ConvertSaveIndexToShardSaveIndex(savegameindex, shardsavegameindex)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Status:"})," ",(0,i.jsx)(s.code,{children:"stable"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"}),"\nConverts legacy SaveIndex format to the modern ShardSaveIndex format for cluster support."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"savegameindex"})," (SaveIndex): The legacy save index"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"shardsavegameindex"})," (ShardSaveIndex): The target shard save index"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"savefileupgrades.utilities.ConvertSaveIndexToShardSaveIndex(oldIndex, newIndex)\n-- Legacy saves now work with cluster system\n"})}),"\n",(0,i.jsx)(s.h2,{id:"version-specific-upgrades",children:"Version-Specific Upgrades"}),"\n",(0,i.jsx)(s.h3,{id:"version-1---rog-season-conversion",children:"Version 1 - RoG Season Conversion"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"})," Converts pre-Reign of Giants summer season to autumn for compatibility."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Changes Applied:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:'Updates season component from "summer" to "autumn"'}),"\n",(0,i.jsx)(s.li,{children:"Adjusts season lengths and day/night cycles"}),"\n",(0,i.jsx)(s.li,{children:"Adds RoG-specific world settings"}),"\n",(0,i.jsx)(s.li,{children:"Disables new RoG monsters and features for classic worlds"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"version-2---prefab-swap-management",children:"Version 2 - Prefab Swap Management"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"})," Handles prefab swap system changes and management updates."]}),"\n",(0,i.jsx)(s.h3,{id:"version-3---default-prefab-swaps",children:"Version 3 - Default Prefab Swaps"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Description:"})," Adjusts default prefab swap settings and clears existing swaps when appropriate."]}),"\n",(0,i.jsx)(s.h3,{id:"version-4-series---a-new-reign-updates",children:"Version 4 Series - A New Reign Updates"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Version 4.0:"})," A Little Fixer Upper - Adds retrofitting flags for forest content\n",(0,i.jsx)(s.strong,{children:"Version 4.1:"})," Warts and All - Adds cave retrofitting for new cave content",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.strong,{children:"Version 4.2:"})," Arts and Crafts - Adds pottery and sculpture content\n",(0,i.jsx)(s.strong,{children:"Version 4.3:"})," Arts and Crafts 2 - Additional sculpture content for forests\n",(0,i.jsx)(s.strong,{children:"Version 4.4:"})," Cute Fuzzy Animals - Adds new animal content\n",(0,i.jsx)(s.strong,{children:"Version 4.5:"})," Herd Mentality - Updates animal behavior systems\n",(0,i.jsx)(s.strong,{children:"Version 4.6:"})," Against the Grain - Adds farming and crop content\n",(0,i.jsx)(s.strong,{children:"Version 4.71-4.77:"})," Heart of the Ruins series - Major cave updates including:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Ruins respawner systems"}),"\n",(0,i.jsx)(s.li,{children:"Atrium and archive content"}),"\n",(0,i.jsx)(s.li,{children:"Chess and statue respawners"}),"\n",(0,i.jsx)(s.li,{children:"Sacred chest additions"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"version-5-series---return-of-them-updates",children:"Version 5 Series - Return of Them Updates"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Version 5.00:"})," Turn of Tides - Enables ocean system for existing forest worlds\n",(0,i.jsx)(s.strong,{children:"Version 5.01-5.02:"})," Ocean navigation and sea stack improvements\n",(0,i.jsx)(s.strong,{children:"Version 5.03:"})," Salty Dog - Additional ocean content\n",(0,i.jsx)(s.strong,{children:"Version 5.04:"})," She Sells Seashells - Hermit crab and seashell content\n",(0,i.jsx)(s.strong,{children:"Version 5.05:"})," Troubled Waters - Barnacle and ocean creature updates\n",(0,i.jsx)(s.strong,{children:"Version 5.06-5.064:"})," Forgotten Knowledge series - Archive system and lunar content\n",(0,i.jsx)(s.strong,{children:"Version 5.07-5.08:"})," Waterlogged - Flooding and water-based content\n",(0,i.jsx)(s.strong,{children:"Version 5.09:"})," Terraria - Terrarium setpiece content\n",(0,i.jsx)(s.strong,{children:"Version 5.10:"})," Catcoon De-extinction - Catcoon respawning systems\n",(0,i.jsx)(s.strong,{children:"Version 5.11:"})," Ocean tile cleanup\n",(0,i.jsx)(s.strong,{children:"Version 5.12:"})," Curse of Moon Quay - Monkey island content\n",(0,i.jsx)(s.strong,{children:"Version 5.13:"})," A Little Drama - Dramatic setpieces\n",(0,i.jsx)(s.strong,{children:"Version 5.141:"})," Daywalker - Brightmare and daywalker content\n",(0,i.jsx)(s.strong,{children:"Version 5.143-5.146:"})," Junk Yard series - Scrapyard content and fixes\n",(0,i.jsx)(s.strong,{children:"Version 5.151:"})," Otter den additions\n",(0,i.jsx)(s.strong,{children:"Version 5.155:"})," Balatro machine content\n",(0,i.jsx)(s.strong,{children:"Version 5.156:"})," Ice hazard fixes at world edges"]}),"\n",(0,i.jsx)(s.h2,{id:"usage-patterns",children:"Usage Patterns"}),"\n",(0,i.jsx)(s.h3,{id:"manual-upgrade-application",children:"Manual Upgrade Application"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'-- Load save file upgrades system\nlocal savefileupgrades = require("savefileupgrades")\n\n-- Check if upgrade is needed\nif savedata.version < savefileupgrades.VERSION then\n    print("Applying save file upgrades...")\n    \n    -- Upgrades are applied automatically during save load\n    -- Individual utilities can be called manually if needed\n    local upgradedPreset = savefileupgrades.utilities.UpgradeUserPresetFromV1toV2(preset, presets)\nend\n'})}),"\n",(0,i.jsx)(s.h3,{id:"automatic-upgrade-during-load",children:"Automatic Upgrade During Load"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'-- Upgrades are automatically applied during save loading\nsaveIndex:Load(function()\n    -- Save data has been automatically upgraded to current version\n    print("Save loaded with current format version:", savefileupgrades.VERSION)\nend)\n'})}),"\n",(0,i.jsx)(s.h3,{id:"custom-preset-migration",children:"Custom Preset Migration"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"-- Handle custom preset upgrades\nlocal customPresets = GetCustomPresets()\nfor i, preset in ipairs(customPresets) do\n    if preset.version < 4 then\n        customPresets[i] = savefileupgrades.utilities.UpgradeUserPresetFromV3toV4(preset, customPresets)\n    end\nend\n"})}),"\n",(0,i.jsx)(s.h2,{id:"retrofitting-system-1",children:"Retrofitting System"}),"\n",(0,i.jsx)(s.h3,{id:"forest-map-retrofitting",children:"Forest Map Retrofitting"}),"\n",(0,i.jsx)(s.p,{children:"Many upgrades use the retrofitting system to add new content to existing worlds:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"-- Example retrofit flag setting (internal)\nif savedata.map.persistdata.retrofitforestmap_anr == nil then\n    savedata.map.persistdata.retrofitforestmap_anr = {}\nend\nsavedata.map.persistdata.retrofitforestmap_anr.retrofit_turnoftides = true\n"})}),"\n",(0,i.jsx)(s.h3,{id:"cave-map-retrofitting",children:"Cave Map Retrofitting"}),"\n",(0,i.jsx)(s.p,{children:"Cave worlds have their own retrofitting system:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"-- Cave retrofit example (internal)  \nif savedata.map.persistdata.retrofitcavemap_anr == nil then\n    savedata.map.persistdata.retrofitcavemap_anr = {}\nend\nsavedata.map.persistdata.retrofitcavemap_anr.retrofit_heartoftheruins = true\n"})}),"\n",(0,i.jsx)(s.h2,{id:"integration-with-game-systems",children:"Integration with Game Systems"}),"\n",(0,i.jsx)(s.h3,{id:"save-loading-integration",children:"Save Loading Integration"}),"\n",(0,i.jsx)(s.p,{children:"The upgrade system integrates seamlessly with save loading:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Automatically detects save version during load"}),"\n",(0,i.jsx)(s.li,{children:"Applies necessary upgrades in sequence"}),"\n",(0,i.jsx)(s.li,{children:"Preserves existing world state and player progress"}),"\n",(0,i.jsx)(s.li,{children:"Flags retrofitting requirements for map systems"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"world-generation-integration",children:"World Generation Integration"}),"\n",(0,i.jsx)(s.p,{children:"Upgrades coordinate with world generation to add new content:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Sets retrofit flags for map generation systems"}),"\n",(0,i.jsx)(s.li,{children:"Adds new setpieces and layout requirements"}),"\n",(0,i.jsx)(s.li,{children:"Updates world options with new features"}),"\n",(0,i.jsx)(s.li,{children:"Maintains backward compatibility for existing worlds"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"mod-system-integration",children:"Mod System Integration"}),"\n",(0,i.jsx)(s.p,{children:"The upgrade system handles mod-related changes:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Migrates mod configuration formats"}),"\n",(0,i.jsx)(s.li,{children:"Updates mod data structures"}),"\n",(0,i.jsx)(s.li,{children:"Preserves mod settings across game updates"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsx)(s.h3,{id:"sequential-processing",children:"Sequential Processing"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Upgrades are applied in version order to ensure consistency"}),"\n",(0,i.jsx)(s.li,{children:"Each upgrade only processes data once"}),"\n",(0,i.jsx)(s.li,{children:"Version checks prevent redundant operations"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"memory-efficiency",children:"Memory Efficiency"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Upgrades modify data in-place when possible"}),"\n",(0,i.jsx)(s.li,{children:"Temporary data is cleaned up after upgrades"}),"\n",(0,i.jsx)(s.li,{children:"Large data structures are handled efficiently"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"io-optimization",children:"I/O Optimization"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"File operations are batched when possible"}),"\n",(0,i.jsx)(s.li,{children:"Retrofit flags minimize redundant world scanning"}),"\n",(0,i.jsx)(s.li,{children:"Upgrade results are cached appropriately"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"error-handling-and-recovery",children:"Error Handling and Recovery"}),"\n",(0,i.jsx)(s.h3,{id:"version-validation",children:"Version Validation"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:"-- Version checking ensures upgrade safety\nlocal currentVersion = savedata.version or 1\nfor i, upgrade in ipairs(savefileupgrades.upgrades) do\n    if currentVersion < upgrade.version then\n        -- Apply upgrade safely\n        upgrade.fn(savedata)\n    end\nend\n"})}),"\n",(0,i.jsx)(s.h3,{id:"corruption-recovery",children:"Corruption Recovery"}),"\n",(0,i.jsx)(s.p,{children:"The system includes safeguards for corrupted save data:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Validates data structure before upgrades"}),"\n",(0,i.jsx)(s.li,{children:"Provides fallback values for missing data"}),"\n",(0,i.jsx)(s.li,{children:"Logs upgrade operations for debugging"}),"\n",(0,i.jsx)(s.li,{children:"Maintains backup state during critical operations"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"console-specific-handling",children:"Console-Specific Handling"}),"\n",(0,i.jsx)(s.p,{children:"Some upgrades include console-specific logic:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'if IsConsole() then\n    -- Apply console-specific fixes\n    FlagForRetrofitting_Forest(savedata, "console_beard_turf_fix")\nend\n'})}),"\n",(0,i.jsx)(s.h2,{id:"related-systems",children:"Related Systems"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/dst-api-webdocs/docs/game-scripts/core-systems/data-management/saves/saveindex",children:"SaveIndex"}),": Main save data management system that uses these upgrades"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./shardindex.md",children:"ShardIndex"}),": Shard-specific save data that also requires upgrades"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./worldgen.md",children:"World Generation"}),": World creation system that processes retrofit flags"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./custompresets.md",children:"Custom Presets"}),": User-created world presets that require migration"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./mods.md",children:"Mod System"}),": Mod management that integrates with upgrade system"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"development-guidelines",children:"Development Guidelines"}),"\n",(0,i.jsx)(s.h3,{id:"adding-new-upgrades",children:"Adding New Upgrades"}),"\n",(0,i.jsx)(s.p,{children:"When adding new game content that requires save compatibility:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Increment Version Number:"})," Choose the next available version number"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Create Upgrade Function:"})," Implement the upgrade logic in the upgrades table"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Set Retrofit Flags:"})," Use retrofitting system for world content"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Test Compatibility:"})," Verify upgrades work with various save states"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Document Changes:"})," Update this documentation with upgrade details"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"version-numbering-convention",children:"Version Numbering Convention"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Integer versions (1, 2, 3):"})," Major feature additions or format changes"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Decimal versions (4.1, 4.2, etc.):"})," Minor content additions within a major update series"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Patch versions (5.143, 5.144):"})," Bug fixes and small improvements"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"retrofit-flag-naming",children:"Retrofit Flag Naming"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Format:"})," ",(0,i.jsx)(s.code,{children:"retrofit_[updatename]_[content]"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Examples:"})," ",(0,i.jsx)(s.code,{children:"retrofit_turnoftides"}),", ",(0,i.jsx)(s.code,{children:"retrofit_heartoftheruins_altars"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Consistency:"})," Use lowercase with underscores for separation"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"technical-implementation-notes",children:"Technical Implementation Notes"}),"\n",(0,i.jsx)(s.h3,{id:"upgrade-function-structure",children:"Upgrade Function Structure"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-lua",children:'{\n    version = 5.156,\n    fn = function(savedata)\n        if savedata == nil then\n            return\n        end\n        \n        -- Apply specific upgrade logic\n        FlagForRetrofitting_Forest(savedata, "sharkboi_ice_hazard_fix")\n    end,\n}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"helper-functions",children:"Helper Functions"}),"\n",(0,i.jsx)(s.p,{children:"The module includes helper functions for common operations:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"FlagForRetrofitting_Forest(savedata, flag_name)"})," - Sets forest retrofit flags"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"FlagForRetrofitting_Cave(savedata, flag_name)"})," - Sets cave retrofit flags"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"data-structure-preservation",children:"Data Structure Preservation"}),"\n",(0,i.jsx)(s.p,{children:"All upgrades are designed to:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Maintain existing save data integrity"}),"\n",(0,i.jsx)(s.li,{children:"Add new features without breaking old content"}),"\n",(0,i.jsx)(s.li,{children:"Preserve player progress and world state"}),"\n",(0,i.jsx)(s.li,{children:"Handle edge cases and corrupted data gracefully"}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>d});var r=n(96540);const i={},t=r.createContext(i);function a(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);