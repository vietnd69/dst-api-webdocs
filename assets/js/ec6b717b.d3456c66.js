"use strict";(self.webpackChunkdst_api_webdocs=self.webpackChunkdst_api_webdocs||[]).push([[3036],{1051:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"api-vanilla/data-types/userdata","title":"Userdata","description":"Last Update: 2023-07-06","source":"@site/docs/api-vanilla/data-types/userdata.md","sourceDirName":"api-vanilla/data-types","slug":"/api-vanilla/data-types/userdata","permalink":"/dst-api-webdocs/docs/api-vanilla/data-types/userdata","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"userdata","title":"Userdata","sidebar_position":5,"last_updated":"2023-07-06T00:00:00.000Z","version":619045},"sidebar":"docs","previous":{"title":"Anim","permalink":"/dst-api-webdocs/docs/api-vanilla/data-types/anim"},"next":{"title":"Utils","permalink":"/dst-api-webdocs/docs/category/utils"}}');var a=n(4848),s=n(8453);const r={id:"userdata",title:"Userdata",sidebar_position:5,last_updated:new Date("2023-07-06T00:00:00.000Z"),version:619045},d="Userdata",o={},l=[{value:"Basic Concepts",id:"basic-concepts",level:2},{value:"Common Userdata Types",id:"common-userdata-types",level:2},{value:"Interacting with Userdata",id:"interacting-with-userdata",level:2},{value:"Read-only vs. Modifiable Userdata",id:"read-only-vs-modifiable-userdata",level:3},{value:"Memory Management",id:"memory-management",level:2},{value:"Limitations and Best Practices",id:"limitations-and-best-practices",level:2},{value:"Limitations",id:"limitations",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Integration with Other Systems",id:"integration-with-other-systems",level:2},{value:"See also",id:"see-also",level:2},{value:"Example: Working with AnimState Userdata",id:"example-working-with-animstate-userdata",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:(0,a.jsx)(t.em,{children:"Last Update: 2023-07-06"})}),"\n",(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"userdata",children:"Userdata"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.em,{children:"API Version: 619045"})}),"\n",(0,a.jsx)(t.p,{children:"Userdata is a special data type in Lua that represents C data in the Lua environment. In the context of Don't Starve Together, userdata objects are native engine objects or custom data structures that are implemented in C/C++ but exposed to Lua for scripting purposes."}),"\n",(0,a.jsx)(t.h2,{id:"basic-concepts",children:"Basic Concepts"}),"\n",(0,a.jsx)(t.p,{children:"Userdata in DST represents data that is managed by the game engine itself rather than by the Lua garbage collector. These objects often encapsulate complex functionality or performance-critical operations that are more efficiently implemented in the native language (C/C++)."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-lua",children:"-- Userdata objects are typically accessed through API functions\nlocal light = TheSim:GetLightAtPoint(x, y, z) -- Returns userdata representing light information\nlocal physics = inst.Physics -- Physics component is a userdata object\n"})}),"\n",(0,a.jsx)(t.h2,{id:"common-userdata-types",children:"Common Userdata Types"}),"\n",(0,a.jsx)(t.p,{children:"In Don't Starve Together, several important engine systems are exposed to Lua as userdata:"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Userdata Type"}),(0,a.jsx)(t.th,{children:"Description"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"AnimState"})}),(0,a.jsx)(t.td,{children:"Animation system controlling entity visuals"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Physics"})}),(0,a.jsx)(t.td,{children:"Physics engine interface for physical interactions"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Light"})}),(0,a.jsx)(t.td,{children:"Lighting system components"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Transform"})}),(0,a.jsx)(t.td,{children:"Positional and orientation data"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"SoundEmitter"})}),(0,a.jsx)(t.td,{children:"Sound playback system"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Network"})}),(0,a.jsx)(t.td,{children:"Networking system for multiplayer sync"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"DynamicShadow"})}),(0,a.jsx)(t.td,{children:"Shadow casting system"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"MiniMapEntity"})}),(0,a.jsx)(t.td,{children:"Minimap representation system"})]})]})]}),"\n",(0,a.jsx)(t.h2,{id:"interacting-with-userdata",children:"Interacting with Userdata"}),"\n",(0,a.jsx)(t.p,{children:"Userdata objects typically provide methods that can be called using the standard Lua method syntax:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-lua",children:'-- Setting position using Transform userdata\ninst.Transform:SetPosition(x, y, z)\n\n-- Playing animations using AnimState userdata\ninst.AnimState:PlayAnimation("idle")\ninst.AnimState:PushAnimation("walk", true)\n\n-- Working with Physics userdata\ninst.Physics:SetMass(10)\ninst.Physics:SetFriction(0.5)\n'})}),"\n",(0,a.jsx)(t.h3,{id:"read-only-vs-modifiable-userdata",children:"Read-only vs. Modifiable Userdata"}),"\n",(0,a.jsx)(t.p,{children:"Some userdata objects in DST are read-only, meaning you can query their state but not modify them directly. Others provide methods for both reading and modifying their state."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-lua",children:"-- Reading from userdata\nlocal x, y, z = inst.Transform:GetWorldPosition() -- Reading position data\n\n-- Modifying userdata (when permitted)\ninst.AnimState:SetMultColor(1, 0, 0, 1) -- Setting animation color to red\n"})}),"\n",(0,a.jsx)(t.h2,{id:"memory-management",children:"Memory Management"}),"\n",(0,a.jsx)(t.p,{children:"Unlike regular Lua tables, userdata objects are not directly managed by Lua's garbage collector. Instead, their lifecycle is typically tied to the entity they belong to. When an entity is removed from the game, its associated userdata objects are cleaned up by the engine."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-lua",children:"-- Userdata is automatically managed when the entity is created or destroyed\nlocal inst = CreateEntity()\ninst.entity:AddAnimState() -- Creates AnimState userdata\ninst.entity:AddTransform() -- Creates Transform userdata\n\n-- When the entity is removed, userdata is cleaned up automatically\ninst:Remove()\n"})}),"\n",(0,a.jsx)(t.h2,{id:"limitations-and-best-practices",children:"Limitations and Best Practices"}),"\n",(0,a.jsx)(t.h3,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"No Direct Creation"}),": Most userdata objects cannot be created directly in Lua; they must be obtained through specific API functions or entity components."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Type Opacity"}),": The internal structure of userdata is opaque to Lua; you can't access or modify its fields directly."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"No Serialization"}),": Userdata cannot be directly serialized or saved; you must store relevant data separately."]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Don't Store Userdata Long-Term"}),": References to userdata objects should not be stored long-term, as they may become invalid when entities are removed."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Check for Nil"}),": Always check if userdata exists before using it, especially when accessing components that may not be present on all entities."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Use Wrapper Functions"}),": Create wrapper functions for complex userdata operations to improve code readability and reusability."]}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-lua",children:"-- Example of a wrapper function for userdata operations\nfunction SetEntityColor(inst, r, g, b, a)\n    if inst.AnimState ~= nil then\n        inst.AnimState:SetMultColor(r, g, b, a or 1)\n    end\nend\n"})}),"\n",(0,a.jsx)(t.h2,{id:"integration-with-other-systems",children:"Integration with Other Systems"}),"\n",(0,a.jsx)(t.p,{children:"Userdata objects often serve as the bridge between Lua scripting and the underlying game engine. They interact with several other systems:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Entity System"}),": Most userdata is associated with specific entities"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Component System"}),": Many components wrap userdata objects to provide higher-level functionality"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Network System"}),": Some userdata objects contain network-synchronized properties"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Serialization System"}),": While userdata itself can't be serialized, its relevant properties can be saved"]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"see-also",children:"See also"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/dst-api-webdocs/docs/api-vanilla/entity-framework/entityscript",children:"EntityScript"})," - For entity creation and management"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/dst-api-webdocs/docs/api-vanilla/data-types/netvar",children:"Network Variables"})," - For synchronized data between server and client"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/dst-api-webdocs/docs/api-vanilla/data-types/vector3",children:"Vector3"})," - For positional data used with Transform userdata"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/dst-api-webdocs/docs/api-vanilla/data-types/colour",children:"Colour"})," - For color values used with AnimState userdata"]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"example-working-with-animstate-userdata",children:"Example: Working with AnimState Userdata"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-lua",children:'local function SetupVisuals(inst)\n    -- Add the AnimState userdata to the entity\n    inst.entity:AddAnimState()\n    \n    -- Configure the AnimState using its methods\n    inst.AnimState:SetBank("spider")\n    inst.AnimState:SetBuild("spider_build")\n    inst.AnimState:PlayAnimation("idle")\n    \n    -- Modify visual properties\n    inst.AnimState:SetScale(1.2, 1.2)\n    inst.AnimState:SetMultColor(0.8, 0.8, 1, 1) -- Slightly blue tint\n    \n    -- Handling animation events\n    inst:ListenForEvent("animover", function(inst)\n        if inst.AnimState:IsCurrentAnimation("attack") then\n            inst.AnimState:PlayAnimation("idle")\n        end\n    end)\nend\n'})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>d});var i=n(6540);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);