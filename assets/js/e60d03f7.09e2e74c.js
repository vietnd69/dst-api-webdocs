"use strict";(self.webpackChunkdst_api_webdocs=self.webpackChunkdst_api_webdocs||[]).push([[65864],{28453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>l});var s=n(96540);const t={},r=s.createContext(t);function a(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:i},e.children)}},83491:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"game-scripts/core-systems/world-systems/generation/regrowthutil","title":"RegrowthUtil","description":"Utility functions for calculating entity regrowth densities and spatial distribution","source":"@site/docs/game-scripts/core-systems/world-systems/generation/regrowthutil.md","sourceDirName":"game-scripts/core-systems/world-systems/generation","slug":"/game-scripts/core-systems/world-systems/generation/regrowthutil","permalink":"/dst-api-webdocs/docs/game-scripts/core-systems/world-systems/generation/regrowthutil","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"regrowthutil","title":"RegrowthUtil","description":"Utility functions for calculating entity regrowth densities and spatial distribution","sidebar_position":5,"last_updated":"2025-06-21T00:00:00.000Z","build_version":676042,"change_status":"stable"},"sidebar":"docs","previous":{"title":"Plant Registry Data","permalink":"/dst-api-webdocs/docs/game-scripts/core-systems/world-systems/generation/plantregistrydata"},"next":{"title":"World Settings Util","permalink":"/dst-api-webdocs/docs/game-scripts/core-systems/world-systems/generation/worldsettingsutil"}}');var t=n(74848),r=n(28453);const a={id:"regrowthutil",title:"RegrowthUtil",description:"Utility functions for calculating entity regrowth densities and spatial distribution",sidebar_position:5,last_updated:new Date("2025-06-21T00:00:00.000Z"),build_version:676042,change_status:"stable"},l="RegrowthUtil",o={},d=[{value:"Version History",id:"version-history",level:2},{value:"Overview",id:"overview",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"Five Radius System",id:"five-radius-system",level:3},{value:"Density-Based Spawning",id:"density-based-spawning",level:3},{value:"Functions",id:"functions",level:2},{value:"CalculateFiveRadius(density)",id:"calculate-five-radius",level:3},{value:"GetFiveRadius(x, z, prefab)",id:"get-five-radius",level:3},{value:"Usage Patterns",id:"usage-patterns",level:2},{value:"Basic Regrowth Check",id:"basic-regrowth-check",level:3},{value:"Density-Based Spawning",id:"density-based-spawning-1",level:3},{value:"Integration with World Systems",id:"integration-with-world-systems",level:2},{value:"Topology Integration",id:"topology-integration",level:3},{value:"Generation Data Dependencies",id:"generation-data-dependencies",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Computational Efficiency",id:"computational-efficiency",level:3},{value:"Caching Recommendations",id:"caching-recommendations",level:3},{value:"Related Systems",id:"related-systems",level:2},{value:"Technical Implementation Notes",id:"technical-implementation-notes",level:2},{value:"Coordinate System",id:"coordinate-system",level:3},{value:"Mathematical Approach",id:"mathematical-approach",level:3},{value:"Legacy Compatibility",id:"legacy-compatibility",level:3}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"regrowthutil",children:"RegrowthUtil"})}),"\n",(0,t.jsx)(i.h2,{id:"version-history",children:"Version History"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Build Version"}),(0,t.jsx)(i.th,{children:"Change Date"}),(0,t.jsx)(i.th,{children:"Change Type"}),(0,t.jsx)(i.th,{children:"Description"})]})}),(0,t.jsx)(i.tbody,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"676042"}),(0,t.jsx)(i.td,{children:"2025-06-21"}),(0,t.jsx)(i.td,{children:"stable"}),(0,t.jsx)(i.td,{children:"Current version"})]})})]}),"\n",(0,t.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"regrowthutil"})," module provides utility functions for calculating entity regrowth patterns in Don't Starve Together. It handles density calculations and spatial distribution logic for the world's regrowth system, ensuring that entities respawn in appropriate quantities and locations based on the original world generation parameters."]}),"\n",(0,t.jsx)(i.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,t.jsx)(i.h3,{id:"five-radius-system",children:"Five Radius System"}),"\n",(0,t.jsx)(i.p,{children:'The regrowth system uses a "five radius" approach where density calculations are performed for groups of 5 entities rather than individual entities. This creates natural clumping patterns that match the original world generation aesthetics.'}),"\n",(0,t.jsx)(i.h3,{id:"density-based-spawning",children:"Density-Based Spawning"}),"\n",(0,t.jsxs)(i.p,{children:["Regrowth calculations rely on the original world generation density data stored in ",(0,t.jsx)(i.code,{children:"TheWorld.generated.densities"}),", ensuring that regrown entities maintain the intended distribution patterns."]}),"\n",(0,t.jsx)(i.h2,{id:"functions",children:"Functions"}),"\n",(0,t.jsx)(i.h3,{id:"calculate-five-radius",children:"CalculateFiveRadius(density)"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," ",(0,t.jsx)(i.code,{children:"stable"})]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Description:"}),'\nCalculates the search radius for regrowth spawning based on entity density. Uses a "five radius" system that groups entities to create natural clumping patterns rather than uniform distribution.']}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"density"})," (number): The target density of entities per area unit"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"(number): The calculated radius for entity placement searches"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Formula:"})}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-lua",children:"local searcharea = 2 * 16 * 5 / density\nreturn math.sqrt(searcharea / math.pi)\n"})}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Example:"})}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-lua",children:"-- Calculate radius for medium density spawning\nlocal density = 0.3\nlocal radius = CalculateFiveRadius(density)\n-- radius will be larger for lower density (more spread out)\n-- radius will be smaller for higher density (more clustered)\n"})}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Technical Notes:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The factor ",(0,t.jsx)(i.code,{children:"16"})," represents tile size conversion (each worldgen tile is 4x4 game units)"]}),"\n",(0,t.jsxs)(i.li,{children:["The factor ",(0,t.jsx)(i.code,{children:"2"})," provides visual correction for proper spacing appearance"]}),"\n",(0,t.jsxs)(i.li,{children:["The factor ",(0,t.jsx)(i.code,{children:"5"})," implements the five-entity grouping system for natural clumping"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"get-five-radius",children:"GetFiveRadius(x, z, prefab)"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," ",(0,t.jsx)(i.code,{children:"stable"})]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Description:"}),"\nDetermines the appropriate regrowth radius for a specific prefab at given world coordinates. Queries the world topology and generation data to find the original density settings for the area."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"x"})," (number): World x-coordinate"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"z"})," (number): World z-coordinate"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"prefab"})," (string): The prefab name to calculate radius for"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"(number|nil): The calculated five radius, or nil if regrowth is not possible"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Example:"})}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-lua",children:'-- Get regrowth radius for trees at specific location\nlocal x, z = 100, 50\nlocal radius = GetFiveRadius(x, z, "evergreen")\nif radius then\n    -- Use radius for regrowth spawning logic\n    print("Regrowth radius for evergreen:", radius)\nelse\n    -- No regrowth possible at this location\n    print("Cannot regrow evergreen at this location")\nend\n'})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Failure Conditions:"}),"\nThe function returns ",(0,t.jsx)(i.code,{children:"nil"})," when:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Coordinates are outside any topology node"}),"\n",(0,t.jsx)(i.li,{children:"World lacks generation data (old save games)"}),"\n",(0,t.jsx)(i.li,{children:"Area has no density data for the specified prefab"}),"\n",(0,t.jsx)(i.li,{children:"Area is a special node type (blockers, etc.)"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Implementation Details:"})}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Area Detection"}),": Uses ",(0,t.jsx)(i.code,{children:"TheSim:WorldPointInPoly()"})," to find the topology node containing the coordinates"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Data Validation"}),": Checks for existence of world generation data and area-specific density information"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Density Lookup"}),": Retrieves density for the specific prefab from ",(0,t.jsx)(i.code,{children:"TheWorld.generated.densities"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Radius Calculation"}),": Calls ",(0,t.jsx)(i.code,{children:"CalculateFiveRadius()"})," with the found density value"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"usage-patterns",children:"Usage Patterns"}),"\n",(0,t.jsx)(i.h3,{id:"basic-regrowth-check",children:"Basic Regrowth Check"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-lua",children:'-- Check if regrowth is possible before attempting spawn\nlocal radius = GetFiveRadius(x, z, prefab_name)\nif radius then\n    -- Proceed with regrowth logic using the calculated radius\n    local entities = TheSim:FindEntities(x, 0, z, radius, {"regrowth_target"})\n    -- Apply regrowth rules based on existing entity count\nend\n'})}),"\n",(0,t.jsx)(i.h3,{id:"density-based-spawning-1",children:"Density-Based Spawning"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-lua",children:"-- Calculate appropriate spacing for different density levels\nlocal low_density_radius = CalculateFiveRadius(0.1)   -- Sparse distribution\nlocal med_density_radius = CalculateFiveRadius(0.5)   -- Medium distribution  \nlocal high_density_radius = CalculateFiveRadius(1.0)  -- Dense distribution\n"})}),"\n",(0,t.jsx)(i.h2,{id:"integration-with-world-systems",children:"Integration with World Systems"}),"\n",(0,t.jsx)(i.h3,{id:"topology-integration",children:"Topology Integration"}),"\n",(0,t.jsx)(i.p,{children:"The regrowth system integrates with the world topology system to:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Identify area boundaries using polygon data"}),"\n",(0,t.jsx)(i.li,{children:"Access area-specific generation parameters"}),"\n",(0,t.jsx)(i.li,{children:"Maintain consistency with original world design"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"generation-data-dependencies",children:"Generation Data Dependencies"}),"\n",(0,t.jsx)(i.p,{children:"Requires access to:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"TheWorld.topology.nodes"})," - Area boundary definitions"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"TheWorld.topology.ids"})," - Area identifier mappings"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"TheWorld.generated.densities"})," - Original density parameters per area and prefab"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,t.jsx)(i.h3,{id:"computational-efficiency",children:"Computational Efficiency"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"CalculateFiveRadius()"})," performs simple mathematical operations with O(1) complexity"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"GetFiveRadius()"})," includes polygon intersection testing which scales with topology complexity"]}),"\n",(0,t.jsx)(i.li,{children:"Density lookup operations are O(1) hash table access"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"caching-recommendations",children:"Caching Recommendations"}),"\n",(0,t.jsx)(i.p,{children:"For performance optimization in regrowth systems:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Cache radius calculations for frequently used density values"}),"\n",(0,t.jsx)(i.li,{children:"Pre-calculate area mappings for common coordinates"}),"\n",(0,t.jsx)(i.li,{children:"Batch process multiple regrowth requests in the same area"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"related-systems",children:"Related Systems"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"./worldgen.md",children:"World Generation"}),": Provides the original density data used by regrowth calculations"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"./topology.md",children:"Topology System"}),": Defines area boundaries and spatial organization"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"./entityscript.md",children:"Entity Management"}),": Handles the actual spawning of regrown entities"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"./theworld.md",children:"TheWorld"}),": Global world state containing generation and topology data"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"technical-implementation-notes",children:"Technical Implementation Notes"}),"\n",(0,t.jsx)(i.h3,{id:"coordinate-system",children:"Coordinate System"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Uses world coordinates (not tile coordinates)"}),"\n",(0,t.jsx)(i.li,{children:"Integrates with DST's standard coordinate system where each tile represents 4x4 game units"}),"\n",(0,t.jsx)(i.li,{children:"Z-coordinate represents the vertical world axis (equivalent to Y in some contexts)"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"mathematical-approach",children:"Mathematical Approach"}),"\n",(0,t.jsx)(i.p,{children:"The five radius calculation balances several competing factors:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Clumping vs Distribution"}),": The factor of 5 creates natural clustering"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Visual Appearance"}),": The factor of 2 provides empirically correct visual spacing"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Performance"}),": Simplified circular area calculations for efficient computation"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"legacy-compatibility",children:"Legacy Compatibility"}),"\n",(0,t.jsx)(i.p,{children:"The system gracefully handles:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Old save games without generation data"}),"\n",(0,t.jsx)(i.li,{children:"Special topology nodes without density information"}),"\n",(0,t.jsx)(i.li,{children:"Missing prefab entries in density tables"}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);